<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ForensiX â€” Digital Forensics CTF</title>

  <!-- Materialize CSS -->
  <link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>

  <!-- Your styles -->
  <link rel="stylesheet" href="/css/styles.css" />
</head>
<body class="black">

  <!-- NAVBAR (Materialize structure) -->
  <nav class="nav-wrapper black">
  <div class="container">
    <a href="/" class="brand-logo teal-text text-accent-2">ForensiX</a>
    <a href="#" data-target="mobile-menu" class="sidenav-trigger">
      <i class="material-icons">menu</i>
    </a>
    <ul class="right hide-on-med-and-down">
      <li><a href="/">Home</a></li>
      <li><a href="/challenges">Challenges</a></li>
      <li><a href="/sample">Sample</a></li>
    </ul>
  </div>
</nav>

<ul class="sidenav" id="mobile-menu">
  <li><a href="/" class="sidenav-link">Home</a></li>
  <li><a href="/challenges" class="sidenav-link">Challenges</a></li>
  <li><a href="/sample" class="sidenav-link">Sample</a></li>
</ul>

  <!-- HERO -->
  <section class="section">
    <div class="container center-align">
      <h4 class="white-text">Welcome to ForensiX</h4>
      <p class="grey-text text-lighten-1 flow-text">
        Train your digital forensics and incident response skills through realistic CTF cases and guided hints.
      </p>
      <a class="btn teal" href="/challenges">
        <i class="material-icons left">play_arrow</i> Solve Challenge
      </a>
    </div>
  </section>

  <!-- CHALLENGE PREVIEWS -->
  <section class="section">
    <div class="container">
      <h5 class="white-text">Available Challenges</h5>
      <div id="challenge-grid" class="row">
        <!-- cards injected by JS -->
      </div>
    </div>
  </section>

  <!-- Materialize + init -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const elems = document.querySelectorAll('.sidenav');
      M.Sidenav.init(elems);
    });

    // Build card grid from API
    async function loadChallenges() {
      try {
        const res = await fetch('/api/challenges');
        const challenges = await res.json();
        const grid = document.getElementById('challenge-grid');
        grid.innerHTML = '';

        if (!Array.isArray(challenges) || !challenges.length) {
          grid.innerHTML = '<p class="grey-text">No challenges available yet.</p>';
          return;
        }

        challenges.forEach(c => {
          const id = c._id || c.id;
          const col = document.createElement('div');
          col.className = 'col s12 m6 l4';

          col.innerHTML = `
            <div class="card hoverable">
              <div class="card-image">
                <img src="${c.image || '/images/challenge.png'}" alt="${c.title}" class="responsive-img">
              </div>
              <div class="card-content">
                <span class="card-title">${c.title || 'Untitled'}</span>
                <p>${c.description || ''}</p>
                <p class="grey-text">Difficulty: ${c.difficulty || 'N/A'}</p>
              </div>
              <div class="card-action">
                <a class="teal-text" href="/play/${id}">Start</a>
              </div>
            </div>
          `;
          grid.appendChild(col);
        });
      } catch (e) {
        console.error(e);
        document.getElementById('challenge-grid').innerHTML =
          '<p class="red-text">Failed to load challenges.</p>';
      }
    }

    loadChallenges();
  </script>
</body>
</html>
